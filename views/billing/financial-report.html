<!DOCTYPE html>
<html>
<head>
	<title>Patients List</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" 	type="text/css" 		href="../../static/css/bootstrap.css">
	<link rel="stylesheet" 	type="text/css" 		href="../../static/css/bootstrap.min.css">
	<link rel="stylesheet" 	type="text/css" 		href="../../static/css/styles.css">
	<link rel="stylesheet" 	type="text/css"			href="../../static/css/font-awesome.min.css">
	<link rel="stylesheet" 	type="text/css" 		href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" 	type="text/css" 		href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">
	<script 				type="text/javascript" 	src="../../static/js/jquery.js"></script>
	<script 				type="text/javascript" 	src="../../static/js/bootstrap.min.js"></script>
	<script 				type="text/javascript"	src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
	<script 				type="text/javascript"  src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
</head>
<body>
	<!-- NAVIGATION -->
	<nav class="navbar navbar-inverse">
	  <div class="container-fluid">
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>                        
	      </button>
	      <a class="navbar-brand" href="/">SPIS LOGO HERE</a>
	    </div>
	    <div class="collapse navbar-collapse" id="navbar">
	      <ul class="nav navbar-nav">
	        <li class="active"><a href="/">Home</a></li>
	      </ul>
	      <ul class="nav navbar-nav navbar-right">
	        <li><a href="#">{{session.user.id}}</a></li>
	        <li><a href="/logout"><span class="glyphicon glyphicon-log-out"></span> Log out</a></li>
	      </ul>
	    </div>
	  </div>
	</nav>
	<!-- END OF NAVIGATION -->

	<div class="container-fluid main-container">
		<!-- BREADCRUMBS -->
		<ol class="breadcrumb">
			<li><a href="/">Home</a></li>
			<li class="active">Financial Report</li>
		</ol>
		<!-- END OF BREADCRUMBS -->
		<center><h3>Financial Report</h3></center><hr>

		<div class="container-fluid">
			<div class="row feature-row" style="padding-top: 20px">
				<div class="col-sm-10 col-sm-offset-1">
					<div class="table-responsive">
						<table id="financial-report" class="table table-striped table-bordered" cellspacing="0" width="100%">
					        <thead>
					            <tr>
					                <th>Date</th>
					                <th>Patient</th>
					                <th>Type</th>
					                <th>Clinic/Hospital</th>
					                {% if not session.doctor %}
					                	<th>Doctor</th>
					                {% endif %}
					                <th>Sum of Expenses</th>
					            </tr>
					        </thead>
					        <tbody>
							</tbody>
					    </table>
					</div>
		        </div>
		    </div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$(document).ready(function() {
		var Financial_Report_List_Table;

		if("{{session.doctor}}"){
			console.log("is doctor");
			Financial_Report_List_Table = $('#financial-report').DataTable({
		    	"bSort": true, 
	            "aaSorting": [[0]],
			   	"aoColumns": [
	                { "bSortable": true },
	                { "bSortable": true },
	                { "bSortable": true },
	                { "bSortable": true },
	                { "bSortable": true }
	            ]    
			});
		} else{
			console.log("is secretary");
			Financial_Report_List_Table = $('#financial-report').DataTable({
		    	"bSort": true, 
	            "aaSorting": [[0]],
			   	"aoColumns": [
	                { "bSortable": true },
	                { "bSortable": true },
	                { "bSortable": true },
	                { "bSortable": true },
	                { "bSortable": true },
	                { "bSortable": true }
	            ]    
			});
		}

		Financial_Report_List_Table = Financial_Report_List_Table.rows().remove().draw();

		$.ajax({
            type: "GET",
            url: "/financial_report_json",
        }).done(function(data){
        	console.log(data);
        	var doctor_name, expenses;
        	if(data.session.doctor){
        		for (var i = data.reports.length - 1; i >= 0; i--) {
        			expenses = 0;
        			var checkup_type = data.reports[i]['parent_record.check_up_type'];

		            Financial_Report_List_Table.row.add([
		                "<a onclick='edit_check_up(\"" + checkup_type + "\"," + data.reports[i]['id'] + ")'>" + data.reports[i]['date'] + "</a>",
		                data.reports[i]['parent_record.patient.first_name']+" "+data.reports[i]['parent_record.patient.middle_name']+" "+data.reports[i]['parent_record.patient.last_name'],
		                data.reports[i]['parent_record.check_up_type'],
		                data.reports[i]['parent_record.hospitalName'],
		                data.reports[i]['expense'],
		            ]).draw();
		        };
        	} else{
				for (var i = data.reports.length - 1; i >= 0; i--) {
					var checkup_type = data.reports[i]['parent_record.check_up_type'];

		            Financial_Report_List_Table.row.add([
		                "<a onclick='edit_check_up(\"" + checkup_type + "\"," + data.reports[i]['id'] + ")'>" + data.reports[i]['date'] + "</a>",
		                data.reports[i]['parent_record.patient.first_name']+" "+data.reports[i]['parent_record.patient.middle_name']+" "+data.reports[i]['parent_record.patient.last_name'],
		                data.reports[i]['parent_record.check_up_type'],
		                data.reports[i]['parent_record.hospitalName'],
		                data.reports[i]['doctorName'],
		                data.reports[i]['expense'],
		            ]).draw();
		        };
        	}

        });
	});

	function edit_check_up(type, key) {
		console.log(type, key);
		console.log(window.location.href);
        // if(type == 'Consultation'){
        //     window.location.href = window.location.href.substring(0, window.location.href.indexOf("#medication")) + '#consultations'
        //     edit_CC(key);
        // }
        // else if(type == 'In-Patient-Treatment'){
        //     window.location.href = window.location.href.substring(0, window.location.href.indexOf("#medication")) + '#ip-treatments'
        //     edit_IPT(key);
        // }
        // else{
        //     window.location.href = window.location.href.substring(0, window.location.href.indexOf("#medication")) + '#op-treatments'
        //     edit_OPT(key);
        // }
    }

</script>
</html>